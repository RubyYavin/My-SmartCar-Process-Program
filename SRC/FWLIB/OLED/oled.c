#include "oled.h"
#include "stdbool.h"

#define SCL_OUT_1 GPIO_SetBits(PTA, GPIO_Pin_16)       //a16
#define SDA_OUT_1 GPIO_SetBits(PTA, GPIO_Pin_15)       //a15

#define SCL_OUT_0 GPIO_ResetBits(PTA, GPIO_Pin_16)      //a16
#define SDA_OUT_0 GPIO_ResetBits(PTA, GPIO_Pin_15)     //a15

#define IIC_Start() {SCL_OUT_1;SDA_OUT_1;SDA_OUT_0;SCL_OUT_0;}
#define IIC_Stop() {SCL_OUT_0;SDA_OUT_0;SCL_OUT_1;SDA_OUT_1;}

extern uint8_t CCD_Threshold;//ccd ???T?μ
extern int CCD_Forward;
extern int CCD_Left;//ccd ×ó±?μ?oú??μ?êy×éμ???±ê
extern int CCD_Right;//ccd óò±?μ?oú??μ?êy×éμ???±ê
extern int CCD_Middle;
extern int Black_Left;//ccd ×ó±?μ?oú??ò?×óê?・??aoú
extern int Black_Right;//ccd óò±?μ?oú??ò?óòê?・??aoú
extern int White_Middle;//middle is white?
extern int system_speed;
extern int target_speed;
extern int top_speed;
extern int min_speed;
extern int ADC_MAX;
extern int ADC2_MAX;
extern int ADC_MIN;
extern int ADC2_MIN;
extern bool turn_left;
extern bool turn_right;
extern bool hold_turn;
extern bool hold_deadly;//ê?・??a ×óí? óòí? ±￡3?×aí?・??ò
extern int steerKp;
extern int steerKd;
extern int steer_pwm;      //target_speed=42;      8,8 ?1DD       14 ,17 óDμ??eμ′￡??1DD
extern int motor_pwm;
extern uint8_t CCD1_Threshold;//ccd 门限值
extern uint8_t CCD2_Threshold;//ccd 门限值
extern int people_wan;
extern int Road_Middle;
unsigned char ascii[]=
{
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",0*/
    0x00,0x00,0x00,0x00,0x9F,0x00,0x00,0x00,/*"!",1*/
    0x00,0x00,0x0F,0x03,0x00,0x0F,0x03,0x00,/*""",2*/
    0x00,0xA4,0x7E,0x25,0xA4,0x7E,0x25,0x00,/*"#",3*/
    0x00,0x00,0x66,0x49,0xC9,0x33,0x00,0x00,/*"$",4*/
    0x00,0x12,0x15,0x52,0xA8,0x48,0x00,0x00,/*"%",5*/
    0x00,0x00,0x60,0x9C,0xB2,0xC2,0xA2,0x00,/*"&",6*/
    0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,/*"'",7*/
    0x00,0x00,0x00,0x00,0xFC,0x03,0x00,0x00,/*"(",8*/
    0x00,0x00,0x03,0xFC,0x00,0x00,0x00,0x00,/*")",9*/
    0x00,0x00,0x02,0x1A,0x07,0x1A,0x02,0x00,/*"*",10*/
    0x00,0x10,0x10,0x10,0xFE,0x10,0x10,0x10,/*"+",11*/
    0x00,0x00,0x00,0xC0,0x40,0x00,0x00,0x00,/*",",12*/
    0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x00,/*"-",13*/
    0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,/*".",14*/
    0x00,0x80,0x60,0x18,0x06,0x01,0x00,0x00,/*"/",15*/
    0x00,0x3E,0x41,0x41,0x3E,0x00,0x00,0x00,/*"0",0*/
    0x00,0x02,0x02,0x7F,0x00,0x00,0x00,0x00,/*"1",1*/
    0x00,0x62,0x51,0x49,0x46,0x00,0x00,0x00,/*"2",2*/
    0x00,0x22,0x41,0x49,0x36,0x00,0x00,0x00,/*"3",3*/
    0x00,0x1C,0x12,0x7F,0x10,0x00,0x00,0x00,/*"4",4*/
    0x00,0x2F,0x49,0x49,0x31,0x00,0x00,0x00,/*"5",5*/
    0x00,0x3E,0x49,0x49,0x32,0x00,0x00,0x00,/*"6",6*/
    0x00,0x41,0x31,0x0D,0x03,0x00,0x00,0x00,/*"7",7*/
    0x00,0x36,0x49,0x49,0x36,0x00,0x00,0x00,/*"8",8*/
    0x00,0x4E,0x51,0x51,0x3E,0x00,0x00,0x00,/*"9",9*/
    0x00,0x00,0x00,0xCC,0xCC,0x00,0x00,0x00,/*":",26*/
    0x00,0x00,0x80,0xCC,0x4C,0x00,0x00,0x00,/*";",27*/
    0x00,0x10,0x10,0x28,0x44,0x44,0x82,0x00,/*"<",28*/
    0x00,0x14,0x14,0x14,0x14,0x14,0x14,0x00,/*"=",29*/
    0x00,0x82,0x44,0x44,0x28,0x10,0x10,0x00,/*">",30*/
    0x00,0x00,0x02,0x81,0xA1,0x11,0x0E,0x00,/*"?",31*/
    0x00,0xFF,0x00,0x18,0x24,0xBF,0x00,0x00,/*"@",32*/
    0x40,0x30,0x1C,0x13,0x1C,0x30,0x40,0x00,/*"A",0*/
    0x00,0x7F,0x49,0x49,0x49,0x36,0x00,0x00,/*"B",1*/
    0x00,0x3E,0x41,0x41,0x41,0x22,0x00,0x00,/*"C",2*/
    0x00,0x7F,0x41,0x41,0x41,0x3E,0x00,0x00,/*"D",3*/
    0x00,0x7F,0x49,0x49,0x49,0x49,0x00,0x00,/*"E",4*/
    0x00,0x7F,0x09,0x09,0x01,0x00,0x00,0x00,/*"F",5*/
    0x00,0x1C,0x22,0x41,0x51,0x51,0x72,0x00,/*"G",6*/
    0x00,0x7F,0x08,0x08,0x08,0x7F,0x00,0x00,/*"H",7*/
    0x00,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,/*"I",8*/
    0x20,0x40,0x40,0x3F,0x00,0x00,0x00,0x00,/*"J",9*/
    0x00,0x7F,0x08,0x14,0x22,0x41,0x00,0x00,/*"K",10*/
    0x00,0x7F,0x40,0x40,0x40,0x00,0x00,0x00,/*"L",11*/
    0x00,0x7F,0x03,0x1C,0x60,0x1C,0x03,0x7F,/*"M",12*/
    0x00,0x7F,0x06,0x08,0x30,0x7F,0x00,0x00,/*"N",13*/
    0x00,0x1C,0x22,0x41,0x41,0x22,0x1C,0x00,/*"O",14*/
    0x00,0x7F,0x11,0x11,0x11,0x0E,0x00,0x00,/*"P",15*/
    0x00,0x1C,0x22,0x41,0x41,0x22,0x5C,0x00,/*"Q",16*/
    0x00,0x7F,0x11,0x11,0x31,0x4E,0x00,0x00,/*"R",17*/
    0x00,0x26,0x49,0x49,0x49,0x32,0x00,0x00,/*"S",18*/
    0x01,0x01,0x7F,0x01,0x01,0x00,0x00,0x00,/*"T",19*/
    0x00,0x3F,0x40,0x40,0x40,0x3F,0x00,0x00,/*"U",20*/
    0x01,0x0E,0x30,0x40,0x30,0x0E,0x01,0x00,/*"V",21*/
    0x03,0x1C,0x60,0x1C,0x03,0x1C,0x60,0x1C,/*"W",22*/
    0x41,0x36,0x08,0x36,0x41,0x00,0x00,0x00,/*"X",23*/
    0x01,0x02,0x04,0x78,0x04,0x02,0x01,0x00,/*"Y",24*/
    0x61,0x51,0x49,0x45,0x43,0x00,0x00,0x00,/*"Z",25*/
    0x00,0x00,0x00,0xFF,0x01,0x01,0x00,0x00,/*"[",59*/
    0x00,0x01,0x06,0x38,0xC0,0x00,0x00,0x00,/*"\",60*/
    0x00,0x01,0x01,0xFF,0x00,0x00,0x00,0x00,/*"]",61*/
    0x00,0x04,0x02,0x01,0x02,0x04,0x00,0x00,/*"^",62*/
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"_",63*/
    0x00,0x00,0x00,0x01,0x02,0x00,0x00,0x00,/*"`",64*/
    0x00,0x24,0x54,0x54,0x78,0x00,0x00,0x00,/*"a",0*/
    0x00,0x7F,0x44,0x44,0x38,0x00,0x00,0x00,/*"b",1*/
    0x00,0x38,0x44,0x44,0x28,0x00,0x00,0x00,/*"c",2*/
    0x00,0x38,0x44,0x44,0x7F,0x00,0x00,0x00,/*"d",3*/
    0x00,0x38,0x54,0x54,0x58,0x00,0x00,0x00,/*"e",4*/
    0x04,0x7E,0x05,0x00,0x00,0x00,0x00,0x00,/*"f",5*/
    0x00,0x38,0x44,0x44,0xFC,0x00,0x00,0x00,/*"g",6*/
    0x00,0x7F,0x04,0x04,0x78,0x00,0x00,0x00,/*"h",7*/
    0x00,0x7D,0x00,0x00,0x00,0x00,0x00,0x00,/*"i",8*/
    0x00,0xFD,0x00,0x00,0x00,0x00,0x00,0x00,/*"j",9*/
    0x00,0x7F,0x18,0x24,0x40,0x00,0x00,0x00,/*"k",10*/
    0x00,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,/*"l",11*/
    0x00,0x7C,0x04,0x78,0x04,0x78,0x00,0x00,/*"m",12*/
    0x00,0x7C,0x04,0x04,0x78,0x00,0x00,0x00,/*"n",13*/
    0x00,0x38,0x44,0x44,0x38,0x00,0x00,0x00,/*"o",14*/
    0x00,0xFC,0x44,0x44,0x38,0x00,0x00,0x00,/*"p",15*/
    0x00,0x38,0x44,0x44,0xFC,0x00,0x00,0x00,/*"q",16*/
    0x00,0x7C,0x04,0x00,0x00,0x00,0x00,0x00,/*"r",17*/
    0x00,0x48,0x54,0x24,0x00,0x00,0x00,0x00,/*"s",18*/
    0x04,0x7E,0x44,0x00,0x00,0x00,0x00,0x00,/*"t",19*/
    0x00,0x3C,0x40,0x40,0x7C,0x00,0x00,0x00,/*"u",20*/
    0x04,0x38,0x40,0x38,0x04,0x00,0x00,0x00,/*"v",21*/
    0x1C,0x60,0x30,0x0C,0x18,0x60,0x1C,0x00,/*"w",22*/
    0x44,0x28,0x10,0x28,0x44,0x00,0x00,0x00,/*"x",23*/
    0x04,0x38,0xC0,0x38,0x04,0x00,0x00,0x00,/*"y",24*/
    0x64,0x54,0x4C,0x44,0x00,0x00,0x00,0x00,/*"z",25*/
    0x00,0x00,0x10,0xEE,0x01,0x00,0x00,0x00,/*"{",91*/
    0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,/*"|",92*/
    0x00,0x00,0x01,0xEE,0x10,0x00,0x00,0x00,/*"}",93*/
    0x00,0x00,0x80,0x80,0x00,0x00,0x80,0x00,/*"~",94*/
};


/***********************Picture Code**************************/
unsigned char show[]=
{
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};
void Display_Info()
{
		int i=0;
    Clean_Screen();
    Display_String(0,0,"CCD:");
    Display_Number(4,0,CCD_Left);
    if(CCD_Middle < 0)
        Display_String(7,0,"-");
    else
        Display_String(7,0," ");        
    Display_Number(8,0,abs(CCD_Middle));
    Display_Number(12,0,CCD_Right);
    
    Display_String(0,1,"C-V:");
    Display_Number(4,1,ADC_MAX);
    Display_Number(8,1,CCD_Threshold);
    Display_Number(12,1,ADC_MIN);
    //UART_printf("%d\n",ADC_MAX);
    
    Display_String(0,2,"LINE:");
    Display_Number(5,2,Black_Left);
    Display_Number(9,2,White_Middle);
    Display_Number(13,2,Black_Right);
    
    Display_String(0,3,"STEER:");
    Display_Number(6,3,steerKp);
    Display_Number(9,3,steerKd);
    Display_Number(12,3,steer_pwm);

    Display_String(0,4,"V:");
    Display_Number(2,4,top_speed);
    Display_Number(6,4,target_speed);
    Display_Number(10,4,min_speed);
    Display_Number(13,4,system_speed);
    
   // Display_String(0,5,"LOGIC:");
		Display_Number(0,5,ADC2_MAX);
		Display_Number(3,5,ADC2_MIN);
    if(turn_left==true)
        Display_String(6,5,"T");
    else
        Display_String(6,5,"F");
    if(turn_right==true)
        Display_String(7,5,"T");
    else
        Display_String(7,5,"F");        
    if(hold_turn==true)
        Display_String(8,5,"T");
    else
        Display_String(8,5,"F");        
    if(hold_deadly==true)
        Display_String(9,5,"T");
    else
        Display_String(9,5,"F");  
		
		//Display_Number(11,5,motor_pwm);
		Display_Number(13,5,abs(Road_Middle));//extern int Road_Middle;
}

void Clean_Screen()
{
    int i;
    for(i=0;i<1024;i++)
        show[i] = 0x00;
}




void oled_init()
{
    GPIO_InitTypeDef GPIO_InitStruct1;
	
	GPIO_InitStruct1.GPIO_Pin = GPIO_Pin_16;    //scl
	GPIO_InitStruct1.GPIO_InitState = Bit_RESET;
	GPIO_InitStruct1.GPIO_IRQMode = GPIO_IT_DISABLE;
	GPIO_InitStruct1.GPIO_Mode = GPIO_Mode_OPP;
	GPIO_InitStruct1.GPIOx = PTA;
	GPIO_Init(&GPIO_InitStruct1);
    
    GPIO_InitStruct1.GPIO_Pin = GPIO_Pin_15;       //sda
	GPIO_InitStruct1.GPIO_InitState = Bit_RESET;
	GPIO_InitStruct1.GPIO_IRQMode = GPIO_IT_DISABLE;
	GPIO_InitStruct1.GPIO_Mode = GPIO_Mode_OPP;
	GPIO_InitStruct1.GPIOx = PTA;
	GPIO_Init(&GPIO_InitStruct1);
    
   
    
	Write_IIC_Command(0xAE);   //display off
	Write_IIC_Command(0x20);	//Set Memory Addressing Mode	
	Write_IIC_Command(0x10);	//00,Horizontal Addressing Mode;01,Vertical Addressing Mode;10,Page Addressing Mode (RESET);11,Invalid
	Write_IIC_Command(0xb0);	//Set Page Start Address for Page Addressing Mode,0-7
	Write_IIC_Command(0xc8);	//Set COM Output Scan Direction
	Write_IIC_Command(0x00);//---set low column address
	Write_IIC_Command(0x10);//---set high column address
	Write_IIC_Command(0x40);//--set start line address
	Write_IIC_Command(0x81);//--set contrast control register
	Write_IIC_Command(0x7f);
	Write_IIC_Command(0xa1);//--set segment re-map 0 to 127
	Write_IIC_Command(0xa6);//--set normal display
	Write_IIC_Command(0xa8);//--set multiplex ratio(1 to 64)
	Write_IIC_Command(0x3F);//
	Write_IIC_Command(0xa4);//0xa4,Output follows RAM content;0xa5,Output ignores RAM content
	Write_IIC_Command(0xd3);//-set display offset
	Write_IIC_Command(0x00);//-not offset
	Write_IIC_Command(0xd5);//--set display clock divide ratio/oscillator frequency
	Write_IIC_Command(0xf0);//--set divide ratio
	Write_IIC_Command(0xd9);//--set pre-charge period
	Write_IIC_Command(0x22); //
	Write_IIC_Command(0xda);//--set com pins hardware configuration
	Write_IIC_Command(0x12);
	Write_IIC_Command(0xdb);//--set vcomh
	Write_IIC_Command(0x20);//0x20,0.77xVcc
	Write_IIC_Command(0x8d);//--set DC-DC enable
	Write_IIC_Command(0x14);//
	Write_IIC_Command(0xaf);//--turn on oled panel 
}

void lcd_address(uint8_t page,uint8_t column)
{

	Write_IIC_Command(0xb0 + column);   /*设置页地址*/
	Write_IIC_Command(((page & 0xf0) >> 4) | 0x10);	/*设置列地址的高4位*/
	Write_IIC_Command((page & 0x0f) | 0x00);	/*设置列地址的低4位*/	
}

void display_graphic_5x7(uint32_t page,uint16_t column,uint8_t *dp)
{
	uint32_t col_cnt;
	uint16_t page_address;
	uint16_t column_address_L,column_address_H;
	page_address = 0xb0+page-1;
	
//	lcd_cs1=0;	
	
	column_address_L =(column&0x0f)-1;
	column_address_H =((column>>4)&0x0f)+0x10;
	
	Write_IIC_Command(page_address); 		/*Set Page Address*/
	Write_IIC_Command(column_address_H);	/*Set MSB of column Address*/
	Write_IIC_Command(column_address_L);	/*Set LSB of column Address*/
	
	for (col_cnt=0;col_cnt<6;col_cnt++)
	{	
		Write_IIC_Data(*dp);
		dp++;
	}
}




/**********************************************
//IIC Start
**********************************************/
//void IIC_Start()
//{
//   SCL_OUT_1;
//   SDA_OUT_1;
//   SDA_OUT_0;
//   SCL_OUT_0;
//}

/**********************************************
//IIC Stop
**********************************************/
//void IIC_Stop()
//{
//   SCL_OUT_0;
//   SDA_OUT_0;
//   SCL_OUT_1;
//   SDA_OUT_1;
//}
/**********************************************
// IIC Write byte
**********************************************/
void Write_IIC_Byte(unsigned char IIC_Byte)
{
	unsigned char i;
	for(i=0;i<8;i++)		
	{
		if(IIC_Byte & 0x80)		
		SDA_OUT_1;
		else
		SDA_OUT_0;
		SCL_OUT_1;
		SCL_OUT_0;
		IIC_Byte<<=1;			
	}
	SDA_OUT_1;
	SCL_OUT_1;
	SCL_OUT_0;
}
/**********************************************
// IIC Write Command
**********************************************/
void Write_IIC_Command(unsigned char IIC_Command)
{
   IIC_Start();
   Write_IIC_Byte(0x78);            //Slave address,SA0=0
   Write_IIC_Byte(0x00);			//write command
   Write_IIC_Byte(IIC_Command); 
   IIC_Stop();
}
/**********************************************
// IIC Write Data
**********************************************/
void Write_IIC_Data(unsigned char IIC_Data)
{
   IIC_Start();
   Write_IIC_Byte(0x78);			
   Write_IIC_Byte(0x40);			//write data
   Write_IIC_Byte(IIC_Data);
   IIC_Stop();
}
/********************************************
// fill_Picture
********************************************/
void fill_picture(unsigned char fill_Data)
{
	unsigned char m,n;
	for(m=0;m<8;m++)
	{
		Write_IIC_Command(0xb0+m);		//page0-page1
		Write_IIC_Command(0x00);		//low column start address
		Write_IIC_Command(0x10);		//high column start address
		for(n=0;n<128;n++)
			{
				Write_IIC_Data(fill_Data);
			}
	}
}
/******************************************
// picture
******************************************/
void Picture()
{
  unsigned char x,y;
  unsigned int i=0;
  for(y=0;y<8;y++)
    {
      Write_IIC_Command(0xb0+y);
      Write_IIC_Command(0x00);
      Write_IIC_Command(0x10);
      for(x=0;x<128;x++)
        {
            //DelayMs(10);
          Write_IIC_Data(show[i++]);
        }
    }
}

void Set_Pos(uint8_t x,uint8_t y)
{
  Write_IIC_Command(0xb0+y);
  Write_IIC_Command(((x&0xf0)>>4)|0x10);
  Write_IIC_Command((x&0x0f)|0x01);
}


void Picture_2(void)
{
  unsigned char x,y;
  for(y=0;y<8;y++)
    {
      Write_IIC_Command(0xb0+y);
      Write_IIC_Command(0x00);
      Write_IIC_Command(0x10);
      for(x=0;x<128;x++)
      {
          DelayMs(10);
          Write_IIC_Data(0xff);
      }
    }
}

void Display_Char(uint8_t x,uint8_t y,uint8_t dat)
{
    uint16_t addr;
    uint8_t i;
    addr = y*128+x*8;
    if(dat>=' '&&dat<='~')
    {
        for(i=0;i<8;i++)
        {
            show[addr+i] = ascii[(dat-' ')*8+i];
        }
    }
}

void Display_String(uint8_t x,uint8_t y,uint8_t *dat)
{
    uint8_t i = 0;
    while(dat[i]!='\0')
    {
        Display_Char(x+i,y,dat[i]);
        i++;
    }
}



void ValueOf(int m,uint8_t *str)
{
	int i = 0;
	static char *ntab = "0123456789ABCDEF";
	int b,k;
	do 
	{
		b = m%10;
		m = m/10;
		str[i] = ntab[b];
		i++;
	} while (m);
	str[i]='\0';
	b = i>>1;
	i--;
	for (k=0;k<b;k++)
	{
		str[k]=str[k]^str[i-k];
		str[i-k]=str[i-k]^str[k];
		str[k]=str[k]^str[i-k];
	}
}

void Display_Number(uint8_t x,uint8_t y,int num)
{
    uint8_t str[20] = {'\0'};
    ValueOf(num,str);
    Display_String(x,y,str);
}

void Display_Pixel(uint8_t y,uint8_t *pixel,uint8_t *pixel2)
{
    int i;
		for(i=25;i<100;i++)
		{
			if(pixel2[i] == 1)//竖直CCD
           show[(y-1)*128+i-25] = 0x7e;
        else
           show[(y-1)*128+i-25] = 0x18;
				//if(i==10 || i==11|| i==12||i==13||i==80||i==81||i==82||i==83)
				//	show[(y-1)*128+i] |= 0x81;
    }
		Display_Number(11,6,CCD_Forward);//显示前方有几个白点
		
		//显示人字弯
		if(people_wan < 0)
       Display_String(14,6,"-");
    else
       Display_String(14,6," ");
		Display_Number(15,6,abs(people_wan));
		
    for(i=0;i<128;i++)
    {	
        if(pixel[i] == 1)
           show[y*128+i] = 0x7e;
        else
           show[y*128+i] = 0x18;
				if(i==62||i==63||i==64||i==65)
					show[y*128+i] |= 0x81;
    }
		
}